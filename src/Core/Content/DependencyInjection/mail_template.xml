<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">
    <services>
        <service id="Laser\Core\Content\MailTemplate\MailTemplateDefinition">
            <tag name="laser.entity.definition"  entity="mail_template"/>
        </service>

        <service id="Laser\Core\Content\MailTemplate\Aggregate\MailTemplateTranslation\MailTemplateTranslationDefinition">
            <tag name="laser.entity.definition"  entity="mail_template_translation"/>
        </service>

        <service id="Laser\Core\Content\MailTemplate\Aggregate\MailTemplateType\MailTemplateTypeDefinition">
            <tag name="laser.entity.definition"  entity="mail_template_type"/>
        </service>

        <service id="Laser\Core\Content\MailTemplate\Aggregate\MailTemplateTypeTranslation\MailTemplateTypeTranslationDefinition">
            <tag name="laser.entity.definition"  entity="mail_template_type_translation"/>
        </service>

        <service id="Laser\Core\Content\MailTemplate\Aggregate\MailTemplateMedia\MailTemplateMediaDefinition">
            <tag name="laser.entity.definition"/>
        </service>

        <service id="Laser\Core\Content\Mail\Service\MailSender" public="true">
            <argument type="service" id="mailer.mailer"/>
            <argument type="service" id="Laser\Core\System\SystemConfig\SystemConfigService"/>
        </service>

        <service id="Laser\Core\Content\Mail\Service\MailFactory" public="true">
            <argument type="service" id="validator"/>
        </service>

        <!-- Controller -->
        <service id="Laser\Core\Content\MailTemplate\Api\MailActionController" public="true">
            <argument type="service" id="Laser\Core\Content\Mail\Service\MailService"/>
            <argument type="service" id="Laser\Core\Framework\Adapter\Twig\StringTemplateRenderer"/>
            <argument type="service" id="Laser\Core\Content\MailTemplate\Service\AttachmentLoader"/>
            <call method="setContainer">
                <argument type="service" id="service_container"/>
            </call>
        </service>

        <!-- Header Footer Entities -->
        <service id="Laser\Core\Content\MailTemplate\Aggregate\MailHeaderFooter\MailHeaderFooterDefinition">
            <tag name="laser.entity.definition"/>
        </service>

        <service id="Laser\Core\Content\MailTemplate\Aggregate\MailHeaderFooterTranslation\MailHeaderFooterTranslationDefinition">
            <tag name="laser.entity.definition"/>
        </service>

        <!-- Header Footer Repository -->
        <service id="Laser\Core\Content\Mail\Service\MailService">
            <argument type="service" id="Laser\Core\Framework\Validation\DataValidator" />
            <argument type="service" id="Laser\Core\Framework\Adapter\Twig\StringTemplateRenderer" />
            <argument type="service" id="Laser\Core\Content\Mail\Service\MailFactory" />
            <argument type="service" id="Laser\Core\Content\Mail\Service\MailSender" />
            <argument type="service" id="media.repository" />
            <argument type="service" id="Laser\Core\System\SalesChannel\SalesChannelDefinition" />
            <argument type="service" id="sales_channel.repository"/>
            <argument type="service" id="Laser\Core\System\SystemConfig\SystemConfigService"/>
            <argument type="service" id="event_dispatcher"/>
            <argument type="service" id="Laser\Core\Content\Media\Pathname\UrlGeneratorInterface"/>
            <argument type="service" id="logger"/>
        </service>

        <service id="Laser\Core\Content\Mail\Service\MailAttachmentsBuilder" public="true">
            <argument type="service" id="Laser\Core\Content\Media\MediaService"/>
            <argument type="service" id="media.repository"/>
            <argument type="service" id="Laser\Core\Checkout\Document\Service\DocumentGenerator"/>
            <argument type="service" id="Doctrine\DBAL\Connection"/>
        </service>

        <service id="core_mailer" alias="mailer" />

        <service id="Laser\Core\Content\Mail\Service\MailerTransportLoader">
            <argument type="service" id="mailer.transport_factory"/>
            <argument type="service" id="Laser\Core\System\SystemConfig\SystemConfigService"/>
            <argument type="service" id="Laser\Core\Content\Mail\Service\MailAttachmentsBuilder"/>
            <argument type="service" id="laser.filesystem.public"/>
            <argument type="service" id="document.repository"/>
        </service>

        <service id="Laser\Core\Content\MailTemplate\Service\AttachmentLoader">
            <argument type="service" id="document.repository"/>
            <argument type="service" id="Laser\Core\Checkout\Document\Service\DocumentGenerator"/>
            <argument type="service" id="event_dispatcher"/>
        </service>
    </services>
</container>
